<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora Motoboy</title>
  <link rel="icon" href="logo.png" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root{--bg:#0f0f10;--card:#16171a;--accent:#00e0a4;--muted:#9aa0a6;--txt:#ffffff}
    body{margin:0;background:var(--bg);color:var(--txt);font-family:Inter,Arial}
    header{display:flex;align-items:center;gap:12px;padding:14px;background:#0b0b0c}
    header img{height:40px;border-radius:6px}
    main{max-width:560px;margin:auto;padding:16px}
    .card{background:var(--card);border-radius:14px;padding:14px;margin-bottom:14px}
    label{font-size:.8rem;color:var(--muted)}
    input,select,button{width:100%;padding:12px;border-radius:10px;border:none;margin-top:6px;background:#0f1013;color:#fff}
    button{cursor:pointer}
    .primary{background:var(--accent);color:#003d2c;font-weight:700}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .total{font-size:1.6rem;font-weight:800;text-align:center}
    ul{padding-left:16px}
    li{font-size:.85rem;margin-bottom:4px}
    #login{position:fixed;inset:0;background:#000;display:flex;align-items:center;justify-content:center;z-index:99}
  </style>
<script>
// ===== MENU HAMBURGUER =====
function toggleMenu(){
  const menu = document.getElementById('menu');
  menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}
function showSection(id){
  document.querySelectorAll('#app section').forEach(sec=>sec.style.display='none');
  document.getElementById(id).style.display='block';
  toggleMenu();
}
</script>
</head>
<body>

<div id="login">
  <div class="card">
    <h3>üîê Acesso por PIN</h3>
    <input id="pin" type="password" placeholder="Digite seu PIN" />
    <button class="primary" onclick="login()">Entrar</button>
  </div>
</div>

<header>
  <img src="logo.png" />
  <strong>Calculadora Motoboy</strong>
  <button onclick="toggleMenu()" style="margin-left:auto;background:none;color:#fff;font-size:22px">‚ò∞</button>
</header>
<nav id="menu" style="display:none;position:fixed;top:0;right:0;width:240px;height:100%;background:#0b0b0c;padding:16px;z-index:100">
  <h3>‚ò∞ Menu</h3>
  <button onclick="showSection('calc')">üìç Calcular</button>
  <button onclick="showSection('hist')">üìú Hist√≥rico</button>
  <button onclick="showSection('cfg')">‚öôÔ∏è Configura√ß√µes</button>
  <hr style="opacity:.2">
  <button onclick="bloquearApp()">üîí Bloquear app</button>
  <button onclick="atualizarApp()">üîÑ Atualizar</button>
  <button onclick="toggleMenu()">‚ùå Fechar</button>
</nav>

<main id="app" style="display:none">
<section class="card" id="calc">
  <h3>üìç C√°lculo da viagem</h3>
  <label>Dist√¢ncia (km)</label>
  <input id="km" type="number" step="0.1" />
  <label>Pontos</label>
  <select id="pontos"><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
  <label>Espera (min)</label>
  <input id="espera" type="number" />
  <label>Cancelamento</label>
  <select id="cancel"><option value="0">N√£o</option><option value="15">Sim</option></select>
  <button class="primary" onclick="calcular()">Calcular</button>
</section>
<section class="card">
  <div class="total" id="total">R$ 0,00</div>
  <p id="detalhe"></p>
  <div class="row">
    <button onclick="gerarPDF()">üìÑ Recibo PDF</button>
    <button onclick="enviarWhats()">üì≤ WhatsApp</button>
  </div>
</section>
<section class="card" id="hist">
  <h3>üìú Hist√≥rico</h3>
  <ul id="historico"></ul>
</section>
<section class="card" id="cfg" style="display:none">
  <h3>‚öôÔ∏è Configura√ß√µes</h3>
  <label>Valor KM</label><input id="cfgKm" type="number" value="1.5" />
  <label>Valor ponto</label><input id="cfgPonto" type="number" value="3" />
  <label>Valor espera/min</label><input id="cfgEspera" type="number" value="0.4" />
  <label>PIN de acesso</label><input id="cfgPin" type="password" placeholder="Novo PIN" />
  <button onclick="salvarCfg()">Salvar</button>
</section>
</main>

<script>
// ====== CONFIGURA√á√ÉO INICIAL ======
const PIN_PADRAO = '1234';
let cfg = JSON.parse(localStorage.getItem('cfg'));
if(!cfg){
  cfg = { km:1.5, ponto:3, espera:0.4, pin: PIN_PADRAO };
  localStorage.setItem('cfg', JSON.stringify(cfg));
}
let hist = JSON.parse(localStorage.getItem('hist')) || [];

// ====== LOGIN ======
function login(){
  const p = document.getElementById('pin').value;
  if(p === cfg.pin){
    document.getElementById('login').style.display='none';
    document.getElementById('app').style.display='block';
  } else {
    alert('PIN incorreto');
  }
}

// ====== C√ÅLCULO ======
function calcular(){
  const kmVal = parseFloat(document.getElementById('km').value) || 0;
  const pontosVal = parseInt(document.getElementById('pontos').value) || 1;
  const esperaVal = parseFloat(document.getElementById('espera').value) || 0;
  const cancelVal = parseFloat(document.getElementById('cancel').value) || 0;

  let total = 0;
  let detalhes = [];

  if(kmVal <= 9.3){
    total = 20;
    detalhes.push('Valor m√≠nimo aplicado (R$ 20,00)');
  } else {
    const vKm = kmVal * cfg.km;
    const vP = pontosVal * cfg.ponto;
    total = vKm + vP;
    detalhes.push(`${kmVal} km √ó R$ ${cfg.km.toFixed(2)} = R$ ${vKm.toFixed(2)}`);
    detalhes.push(`${pontosVal} ponto(s) √ó R$ ${cfg.ponto.toFixed(2)} = R$ ${vP.toFixed(2)}`);
  }

  if(esperaVal > 0){
    const vE = esperaVal * cfg.espera;
    total += vE;
    detalhes.push(`Espera: R$ ${vE.toFixed(2)}`);
  }

  if(cancelVal > 0){
    total += cancelVal;
    detalhes.push('Cancelamento: R$ 15,00');
  }

  document.getElementById('total').innerText = `R$ ${total.toFixed(2)}`;
  document.getElementById('detalhe').innerText = detalhes.join(' ‚Ä¢ ');

  hist.unshift({data:new Date().toLocaleString(), total});
  localStorage.setItem('hist', JSON.stringify(hist));
  renderHist();
}

// ====== HIST√ìRICO ======
function renderHist(){
  const ul = document.getElementById('historico');
  ul.innerHTML = '';
  hist.slice(0,5).forEach(h => {
    ul.innerHTML += `<li>${h.data} ‚Äî R$ ${h.total.toFixed(2)}</li>`;
  });
}

// ====== CONFIGURA√á√ïES ======
function salvarCfg(){
  cfg.km = parseFloat(document.getElementById('cfgKm').value);
  cfg.ponto = parseFloat(document.getElementById('cfgPonto').value);
  cfg.espera = parseFloat(document.getElementById('cfgEspera').value);
  const novoPin = document.getElementById('cfgPin').value;
  if(novoPin){ cfg.pin = novoPin; }
  localStorage.setItem('cfg', JSON.stringify(cfg));
  alert('Configura√ß√µes salvas e aplicadas');
  // aplica imediatamente sem sair do app
  showSection('calc');
}

// ====== PDF REAL ======
function gerarPDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  pdf.setFontSize(18);
  pdf.text('Itaim Connect Motoboy', 20, 20);

  pdf.setFontSize(11);
  pdf.text(`Data: ${new Date().toLocaleString()}`, 20, 30);
  pdf.text(`Dist√¢ncia: ${document.getElementById('km').value} km`, 20, 40);
  pdf.text(`Pontos: ${document.getElementById('pontos').value}`, 20, 50);
  pdf.text(`Total: ${document.getElementById('total').innerText}`, 20, 65);

  pdf.save(`recibo_${Date.now()}.pdf`);
}

// ====== WHATSAPP ======
function enviarWhats(){
  const valor = document.getElementById('total').innerText;
  window.open(`https://wa.me/?text=Valor%20da%20viagem:%20${valor}`);
}

renderHist();

// ===== CONTROLES EXTRAS =====
function bloquearApp(){
  document.getElementById('app').style.display='none';
  document.getElementById('login').style.display='flex';
  toggleMenu();
}

function atualizarApp(){
  location.reload();
}
</script>
</body>
</html>
